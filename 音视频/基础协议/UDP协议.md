## UDP协议

![image-20210828175223428](https://strsh-image-md.oss-cn-shanghai.aliyuncs.com/image/image-20210828175223428.png)





## RTP

应用层协议 既可以应用于UDP,也可TCP ,通畅 UDP

![image-20210828175427483](https://strsh-image-md.oss-cn-shanghai.aliyuncs.com/image/image-20210828175427483.png)



**各个字段的解释：**

1. V：当前的协议的版本号是2，其中0和1已经在草案规范中被占用，这里基本就是固定值了；

2. P：填充标记，包的末尾包含了一个或者多个填充字节，其中填充字节的第一字节包括了后面填充字节的长度，该长度字段包含自己，主要是为了一些对齐处理；

3. X位，如果为1则说明有扩展头，一般默认为0，很少有场景会用到；

4. CC位：是为了计算后面有多少个CSRC，四位说明则最大支持15个CSRC，一般默认为0。

5. M位：特别对于视频而言就是一帧的结束，视频帧比较大，需要通过多个NALU来传输，当看到M位为1时就认为是这个I帧的结束，由于音频帧比较小，一个RTP包就是一个音频帧，所以该位直接置1。

6. Sequence number序列号：16位，用于标识发送者发送的RTP报文序列号，每发送一个RTP包，则这里就增加1，当达到最大值后，则重新从0开始。刚才说了一般RTP协议是承载协议是UDP，UDP是不可靠传输协议。那我们如何保证接收端收的数据是正确的呢，就是通过这个字段进行重新排序，所以接收端一般收到RTP数据第一件事就是排序。

   特别注意两点：

   ​	a. 这个序列号的初始值可以为0但是也可以为其它随机值，只要符合+1就行;

   ​	b.发送端的音频和视频都是通过RTP传输的，但是他们是分别计数的，所用的序列号是不同的。

7. timestamp时间戳：占32位四字节，这个单位要注意是采样率到倒数，不是真实的时间，一般要根据采样率进行换算。这里反应的RTP报文第一个八位组的采样时刻，目的是为了接收端计算延迟、抖动和音视频同步。需要说明的是，一个视频帧的时间戳是相同的，但是一个视频帧数据量很大可能需要多个RTP包传输，这样就存在多个RTP包时间戳相同的情况，音频帧数据小，不存在音频帧跨RTP的情况，所以不存在这个问题。

8. SSR同步信号源：占32位四字节，用于标识同步信号源，这个值只要保证在一路音视频会话里面值不相同即可。该标识符是随机选取的 RFC1889推荐了MD5随机算法。该值的作用就是在会话中标识RTP负载流的身份，给一个唯一标记值。

9. CSRC特约信号源CSRC:同样是32位，四字节。一个RTP头最多可以含有0-15个，如果是1对1的流媒体传输，这个字段就不用处理，直接忽略该字段。但是混流和混音时，则需要把各方的RTP同步信号源列出来，这样接收端就能正确指出交谈双方的身份。





## RTCP

![image-20210828182001959](https://strsh-image-md.oss-cn-shanghai.aliyuncs.com/image/image-20210828182001959.png)

![image-20210828182015016](https://strsh-image-md.oss-cn-shanghai.aliyuncs.com/image/image-20210828182015016.png)

![image-20210828182403903](https://strsh-image-md.oss-cn-shanghai.aliyuncs.com/image/image-20210828182403903.png)

### RTCP Type

![image-20210828182613000](https://strsh-image-md.oss-cn-shanghai.aliyuncs.com/image/image-20210828182613000.png)

![image-20210828183538512](https://strsh-image-md.oss-cn-shanghai.aliyuncs.com/image/image-20210828183538512.png)